<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="longfei"><meta name=description content="我的个人博客"><meta name=keywords content="Golang,Database,macOS,Life,Thinking"><link rel=prev href=https://longfeis.me/2020/hello-hugo-blog/><link rel=next href=https://longfeis.me/2021/my-macos-setup/><link rel=canonical href=https://longfeis.me/2020/hackintosh/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>自己动手安装黑苹果 | Longfei's Blog</title><meta name=title content="自己动手安装黑苹果 | Longfei's Blog"><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/longfeis.me\/"},"articleSection":"posts","name":"自己动手安装黑苹果","headline":"自己动手安装黑苹果","description":"概述 组黑苹果有两个层次，如下所述： ✅ 能用的黑果 正确配置 OC 引导，能够正常的进入 macOS，能够安装并使用工作常用的软件。本人系程序猿一枚，常用","inLanguage":"zh-cn","author":"longfei","creator":"longfei","publisher":"longfei","accountablePerson":"longfei","copyrightHolder":"longfei","copyrightYear":"2020","datePublished":"2020-12-29 09:25:49 \u002b0800 \u002b0800","dateModified":"2020-12-29 09:25:49 \u002b0800 \u002b0800","url":"https:\/\/longfeis.me\/2020\/hackintosh\/","wordCount":"6408","keywords":["macOS","Longfei\u0027s Blog"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>➜ ~</span>
<a href=https://longfeis.me/><span class=logo_text>sudo rm -fr /</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/wiki/ title>Wiki</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://longfeis.me/>Longfei's Blog</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/posts/ title><h3>Blog</h3><div class=menu-active></div></a><a class=menu-item href=/wiki/ title><h3>Wiki</h3><div class=menu-active></div></a><a class=menu-item href=/categories/ title><h3>Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags/ title><h3>Tags</h3><div class=menu-active></div></a><a class=menu-item href=/about/ title><h3>About</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">自己动手安装黑苹果</h1><div class=post-meta>Written by <a itemprop=name href=https://longfeis.me/ rel=author>longfei</a> with ♥
<span class=post-time>on <time datetime=2020-12-29 itemprop=datePublished>December 29, 2020</time></span>
in
<i class="iconfont icon-folder"></i>
<span class=post-category><a href=https://longfeis.me/categories/mac/linux%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/>Mac/Linux杂七杂八,</a></span>
<span class=post-word-count>6408 words</span></div></header><div class=post-content><h2 id=概述>概述</h2><p>组黑苹果有两个层次，如下所述：</p><ol><li><p>✅ 能用的黑果</p><p>正确配置 OC 引导，能够正常的进入 macOS，能够安装并使用工作常用的软件。本人系程序猿一枚，常用的工作环境以及软件有 homebrew、golang、docker、vscode 等，这些软件因人而异。</p></li><li><p>✅ 好用的黑果</p><p>支持蓝牙、随航、隔空投送、正常休眠唤醒、各种 usb 设备正常工作。但这些都是使用黑果的非必要条件。</p></li></ol><p>对于我个人来说，折腾黑果的最大动力就是经济效益。全套下来 <code>主机（5000RMB）+4K显示器（2000RMB）= 7k</code> 左右，能够体验到 <code>20k</code> 的效果，个人感觉还是超值的。</p><p>其次，黑果能够提供给我一个<strong>稳定有效</strong>的工作环境。我不太介意每次开机需要重新插拔一下键盘或者鼠标的 USB 接口，也不太介意能否正常休眠唤醒（PS. 因为是台式机，所以不太需要休眠，能锁屏就行）。所以对我来说，第一目标就可以满足我的需求，第二目标中的一些功能可以等到需要时再慢慢想办法支持。</p><h2 id=介绍>介绍</h2><p>我最开始接触并动手组建自己的黑果是在 2020 年，这是一个尴尬的时间节点。因为在 2020 年，苹果公司推出了基于 arm 架构的 m1 芯片（据坊间测评，性能提升还蛮多）。这意味着基于x86的黑果可能没有多少日子了。但是，如果是为了工作或者单纯体验一下苹果系统，这并不是很大的问题。</p><p>目前，我已成功在两台不同配置的台式机上装上了macOS，分别是：</p><ol><li>8700k + 华硕ROG的m10f（z370芯片组）</li><li>10700 + 微星迫击炮b460m</li></ol><p>其中配置1是2018年组装的，并非以装黑果为目的，安装的时候遇到了一些小问题；而配置2是根据黑果的要求进行的硬件选购，安装起来要方便很多。</p><p>对于不同配置，安装过程大同小异，下面就来说说安装黑果的一个大致流程。👇</p><h2 id=安装的流程步骤>安装的流程步骤</h2><p>安装大致分为以下5步：</p><ol><li>查看（确定）电脑配置</li><li>收集（制作）EFI</li><li>制作USB启动盘</li><li>安装调试</li><li>启动后调优</li></ol><h2 id=配置>配置</h2><p>自己的配置务必搞清楚！需要搞清楚哪些？可以参考我的配置单。</p><p>我将以 8700k 这套为代表来对黑果硬件进行说明。这套攒于2018年，是当时的顶配。目前服役2年多，当时主要是为了玩游戏，并未考虑后面会安装黑苹果。</p><p>先列下配置，再说下这套配置的问题，最后在说下配置的选择。</p><h3 id=配置单>配置单</h3><table><thead><tr><th>配件</th><th>型号</th></tr></thead><tbody><tr><td>CPU</td><td>Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz</td></tr><tr><td>GPU（显卡）</td><td>NVIDIA GeForce GTX 1080 Ti<br>intel UHD630</td></tr><tr><td>主板芯片组</td><td>Z370</td></tr><tr><td>声卡</td><td>NVIDIA GP102 HDMI/DP @ NVIDIA GP102 - High Definition Audio Controller<br>Realtek ALC1220 @ Intel Kaby Point PCH - High Definition Audio Controller (Audio, Voice, Speech)</td></tr><tr><td>网卡</td><td>Intel Ethernet Connection (2) I219-V<br>Realtek RTL8822BE Wireless LAN 802.11ac PCI-E Network Adapter</td></tr><tr><td>硬盘</td><td>Samsung SSD 960 EVO 250GB<br>WDC WD20EZRZ-00Z5HB0</td></tr></tbody></table><h3 id=配置问题>配置问题</h3><p>这套配置中NVIDIA显卡和Realtek无线网卡是没法驱动的。</p><p>对于显卡而言，如果有剪辑视频需求，那么需要另行购入免驱A卡，N卡都是不能驱动的（只能安装较低版本的macOS）。本人主要是用来作后端开发，直接使用8700k自带uhd630核显就可以。</p><p>对于无线网卡，本人另外购买了博通的BCM94360CD，这是免驱卡，可以同时解决无线和蓝牙的问题。</p><h3 id=配置怎么选>配置怎么选</h3><p>网上有很多类似的说明，下面是我的简要心得：</p><ol><li>cpu选intel的，最好是带核显，amd虽然也行，但是安装起来比较折腾</li><li>显卡，最好购买a卡，买之前先查查能否在macOS中免驱，N卡就别想了</li><li>无线网卡，买博通的免驱网卡，在windows上也可以用</li><li>如果是从零组机，那就照着别人的配置单抄吧。那么，整个安装过程就简单百倍。</li></ol><p>其他的好像也没啥特别注意的地方了。如果想详细了解硬件限制，推荐阅读下面这篇文章：<a href=https://dortania.github.io/OpenCore-Install-Guide/macos-limits.html>Hardware Limitations</a>。</p><h2 id=制作efi>制作EFI</h2><p>最简单的方法就是收集别人做好的EFI。可以到github上以<code>CPU 芯片组 EFI</code>为关键词进行搜索，如<code>8700k z370 EFI</code>，也可以去远景论坛看看。</p><p>但是，我还是推荐自己动手制作EFI，其实也没那么困难。推荐的阅读材料《<a href=https://dortania.github.io/OpenCore-Install-Guide/>OpenCore-Install-Guide</a>》。对于手动制作EFI的人来说，大概都会看这个install guide吧，多看多动手。</p><p>制作EFI，主要分为三大部分：</p><ol><li>制作USB启动盘</li><li>收集Kexts、Drivers以及SSDT</li><li>配置config.plist</li></ol><p>👇是一些我认为的<strong>关键术语</strong>，理解后可以更好的阅读《Guide》：</p><table><thead><tr><th>术语</th><th>描述</th></tr></thead><tbody><tr><td><strong>ACPI</strong></td><td>高级配置与电源接口。是一种规范，用来定义固件抽象接口。详细可以阅读 <a href=https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface>维基百科</a></td></tr><tr><td><strong>Kexts</strong></td><td><strong>k</strong>ernel <strong>ext</strong>ension（内核拓展），可以理解为macOS的驱动</td></tr><tr><td><strong>Drivers</strong></td><td>指UEFI驱动</td></tr><tr><td><strong>DSDT</strong></td><td>Differentiated System Description Table. DSDT可以被看作是持有大部分信息的主体，就如同项目蓝图。</td></tr><tr><td><strong>SSDT</strong></td><td>Secondary System Description Table. SSDT传递较小的信息，可以想象为项目进展中的便利贴。</td></tr></tbody></table><h3 id=制作usb启动盘>制作USB启动盘</h3><ol><li><p>下载macOS安装镜像</p><p>我使用过两种方法来下载macOS的安装镜像，根据实际的安装体验，我比较推荐recovery模式，更方便快捷:</p><ol><li><p>使用recovery模式</p><p>对于recovery模式，只需要在命令行执行一条简单的命令就可以了：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./macrecovery.py -b Mac-E43C1C25D4880AD6 -m <span style=color:#ae81ff>00000000000000000</span> -os latest download
<span style=color:#75715e># 🔎 参考 install guide 获取详细说明 </span>
</code></pre></div><p>macrecovery是OC官方提供的工具，其通过下载一个恢复dmg，在安装时再次联网下载完整的macOS，就跟白苹果的开机按CMD+R重启到恢复模式一样。Recovery dmg比较小，用一个小u盘就能搞定。</p><p>对于其他版本，也有不同的命令，可以点开<a href=https://raw.githubusercontent.com/acidanthera/OpenCorePkg/master/Utilities/macrecovery/recovery_urls.txt>recovery_urls.txt</a>查看。</p></li><li><p>完整模式</p><p>完整的安装包通常有好几个G，官网下载时间比较长。国内的话可以通过下载其他人，比如黑果小兵，分享的安装包。通过<a href=https://www.balena.io/etcher/>etcher</a>，将安装包写入我们的u盘，最后在用自己的EFI文件覆盖u盘里的。</p></li></ol></li><li><p>写盘</p><p>写盘的关键点在于预留好一块fat32格式的EFI分区，用来存放接下来要制作的EFI文件。方式方法也比较多：</p><ul><li>windows的磁盘管理器</li><li>使用第三方工具，，如<a href=https://rufus.ie/>rufus</a>、<a href=https://www.balena.io/etcher/>etcher</a>等，轻松创建USB启动盘</li><li>使用命令行工具<code>diskpart</code></li></ul></li></ol><h3 id=收集kextsdrivers以及ssdt>收集Kexts、Drivers以及SSDT</h3><ul><li>SSDTs和DSDTs，以<code>.aml</code>为文件名后缀，放到ACPI文件夹下</li><li>Kexts，以<code>.kext</code>为后缀，放到Kexts文件夹下</li><li>Firmware Drivers（固件驱动），以<code>.efi</code> 为后缀，放到Drivers文件夹下</li></ul><p>以下是8700k+z370，也就是我这套，需要收集的东西：</p><h4 id=firmware-drivers>Firmware Drivers</h4><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td><a href=https://github.com/acidanthera/OcBinaryData/blob/master/Drivers/HfsPlus.efi>HfsPlus.efi</a></td><td>能够显示 HFS 卷，HFS（分层文件系统，macOS上的文件系统）</td></tr><tr><td><a href=https://github.com/acidanthera/OpenCorePkg/releases>OpenRuntime.efi</a></td><td>用作OpenCore的扩展，以帮助修补boot.efi以获得NVRAM修复和更好的内存管理。</td></tr></tbody></table><h4 id=kexts>Kexts</h4><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td><a href=https://github.com/acidanthera/VirtualSMC/releases>VirtualSMC</a></td><td>仿真macs上的SMC芯片，如果没有此芯片，macOS将无法启动</td></tr><tr><td><a href=https://github.com/acidanthera/Lilu/releases>Lilu</a></td><td>许多其他Kexts依赖Lilu，如AppleALC, WhateverGreen, VirtualSMC，没有Lilu，这些Kexts无法工作</td></tr><tr><td>SMCProcessor.kext</td><td>🌡️ VirtualSMC插件，用于监控CPU温度</td></tr><tr><td>SMCSuperIO.kext</td><td>🍃 VirtualSMC插件，用于监控风扇转速</td></tr><tr><td><a href=https://github.com/acidanthera/WhateverGreen/releases>WhateverGreen</a></td><td>显卡驱动</td></tr><tr><td><a href=https://github.com/acidanthera/AppleALC/releases>AppleALC</a></td><td>声卡驱动</td></tr><tr><td><a href=https://github.com/acidanthera/IntelMausi/releases>IntelMausi</a><br><a href=https://www.insanelymac.com/forum/files/file/1004-lucyrtl8125ethernet/>LucyRTL8125Ethernet</a></td><td>以太网卡驱动。本人是英特尔I219-V，所以选这个，根据自己情况选择。<br>我的另外一台是realtek的2.5G的网卡，所以选LucyRTL8125Ethernet</td></tr><tr><td><a href=https://bitbucket.org/RehabMan/os-x-usb-inject-all/downloads/>USBInjectAll</a></td><td>可以暂时使用此kext启用所有端，以便确认哪些端口是真正需要注入的。个人理解：搭配config.plist中的XhciPortLimit暂时使用，长远的方法还是需要指定USB端口映射</td></tr><tr><td><a href=https://github.com/RehabMan/OS-X-USB-Inject-All>XHCI-unsupported</a></td><td>注入对Intel xHCI controllers的支持。我们的主板不需要，不过放进去也没关系（PS. 如果搞不清是否需要，就放进去）。</td></tr><tr><td>网卡和蓝牙</td><td>买的是免驱的，都不需要</td></tr><tr><td><a href=https://github.com/acidanthera/NVMeFix/releases>NVMeFix</a></td><td>🔌 修正非苹果NVMe的电源管理和初始化</td></tr><tr><td><a href=https://github.com/khronokernel/Legacy-Kexts/blob/master/Injectors/Zip/SATA-unsupported.kext.zip>SATA-Unsupported</a></td><td>没有SATA，不需要</td></tr></tbody></table><h4 id=acpi>ACPI</h4><p>✅ 确定cpu的平台？</p><p>桌面cpu，8700k的平台是Coffee Lake</p><p>✅ 确定需要哪些SSDT？</p><p>参考《Guide》，我们需要如下SSDT</p><table><thead><tr><th>名称</th><th>作用</th></tr></thead><tbody><tr><td>SSDT-PLUG</td><td>修复电源管理</td></tr><tr><td>SSDT-EC/USBX</td><td>1. 解决EC与macOS的AppleACPIEC不兼容问题<br>2. 创建一个虚拟的EC来满足macOS的AppleBusPowerController的需要<br>3. AppleBusPowerController也需要USBX设备提供USB电源属性</td></tr><tr><td>SSDT-AWAC</td><td>⏰ 修复系统时钟</td></tr><tr><td>SSDT-PMC</td><td>修复NVRAM，但貌似z370主板不需要</td></tr></tbody></table><p>综上所述，我们使用将前三个放到ACPI文件夹下就可以了。PS：下载《Guide》中预编译好的就可以，感兴趣的话可以后面在动手自己编译。</p><h3 id=配置configplist>配置config.plist</h3><p><em>这节大部分上是在翻译《 <a href=https://dortania.github.io/OpenCore-Install-Guide/config.plist/coffee-lake.html#starting-point>guide</a>》</em>，还有一些自己的理解。</p><p>配置config.plist是比较麻烦的一步，也是最容易出错的一步。建议去睡一觉，睡醒之后再来操作，操作之前，多看几遍教程。</p><p><strong>《guide》上没有提到的内容，不用管，保持默认就好</strong></p><p>配置好以后，可以使用 <a href=https://opencore.slowgeek.com/>OpenCore Sanity Checker</a> 对我们的config.plist进行检查。</p><p>选择好CPU和OC的版本<strong>以后</strong>，将config.plist拖进去。根据它给出的提示进行改正，不确定的地方以《guide》为准。</p><h4 id=acpi-1>ACPI</h4><h5 id=add>Add</h5><p>add下的条目与ACPI文件夹下的内容一一对应，这儿<a href=https://github.com/corpnewt/ProperTree>ProperTree</a>会帮我们弄好，只需要检查一下即可</p><h4 id=booter>Booter</h4><h5 id=quirks>Quirks</h5><p>检查并改正需要修改的值即可</p><table><thead><tr><th>名称</th><th>值</th><th>修改？</th><th>说明</th></tr></thead><tbody><tr><td>AvoidRuntimeDefrag</td><td>YES</td><td></td><td>修复运行时服务，例如日期、时间、NVRAM、电源控制等</td></tr><tr><td>DevirtualiseMmio</td><td>YES</td><td>*</td><td>减少内存占用，修复z390内存分配问题</td></tr><tr><td>EnableSafeModeSlide</td><td>YES</td><td></td><td>让slide变量能在安全模式下使用（🙈 不懂）</td></tr><tr><td>EnableWriteUnprotector</td><td>NO</td><td>*</td><td>写保护，和RebuildAppleMemoryMap是冲突的，我们关掉这个</td></tr><tr><td>ProtectUefiServices</td><td>NO</td><td>*</td><td>保护UEFI的服务不被firmware覆盖。在z390主板上启用</td></tr><tr><td>ProvideCustomSlide</td><td>YES</td><td></td><td>用于计算slide变量，只有在debug日志中看到“OCABC: All slides are usable! You can disable ProvideCustomSlide!”，才需要关闭</td></tr><tr><td>RebuildAppleMemoryMap</td><td>YES</td><td>*</td><td>生成与macOS兼容的Memory Map</td></tr><tr><td>SetupVirtualMap</td><td>YES</td><td></td><td>修复SetVirtualAddresses对虚拟地址的调用</td></tr><tr><td>SyncRuntimePermissions</td><td>YES</td><td>*</td><td>修复MAT tables对齐，跟RebuildAppleMemoryMap相关</td></tr></tbody></table><h4 id=deviceproperties>DeviceProperties</h4><h5 id=add-1>Add</h5><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>PciRoot(0x0)/Pci(0x2,0x0)</td><td>帧缓冲相关，用于设置核显属性。<em>AAPL,ig-platform-id</em>是macOS用来决定核显驱动如何和系统交互的。<em>framebuffer-patch-enable</em>是启用WhateverGreen.kext的patch功能。<em>framebuffer-stolenmem</em>用于设置核显显存为19MB，通常这个不需要的，因为通过BIOS可以设置为64MB。<br>当使用独显输出时，不需要设置framebuffer-相关。</td></tr><tr><td>PciRoot(0x0)/Pci(0x1b,0x0)</td><td>设置声卡布局。我的板载声卡是Realtek ALC1220，通过查询《<a href=https://github.com/acidanthera/AppleALC/wiki/Supported-codecs>AppleALC Supported Codecs</a>》知道我们的layout有：1, 2, 3, 5, 7, 11, 13, 15, 16, 21, 27, 28, 29, 34。随便选一个填上就好。安装好系统以后，如果声卡不工作，再一个个试就行</td></tr></tbody></table><h4 id=kernel>Kernel</h4><h5 id=quirks-1>Quirks</h5><table><thead><tr><th>名称</th><th>值</th><th>修改？</th><th>说明</th></tr></thead><tbody><tr><td>AppleCpuPmCfgLock</td><td>NO</td><td></td><td>Ivy Bridge以及更老的cpu上关闭cfg lock的</td></tr><tr><td>AppleXcpmCfgLock</td><td>YES</td><td>*</td><td>Haswell以及更新的cpu上关闭cfg lock的（PS：cfg lock也可以通过BIOS来关）</td></tr><tr><td>CustomSMBIOSGuid</td><td>NO</td><td></td><td>和UpdateSMBIOSMode一起使用，当UpdateSMBIOSMode设置为Custom时，执行GUID修补。会影响其他操作系统的启动，不推荐使用</td></tr><tr><td>DisableIOMapper</td><td>YES</td><td>*</td><td>关闭IO mapper（PS：类似BIOS里面关闭vt-d）</td></tr><tr><td>DisableLinkeditJettison</td><td>YES</td><td></td><td>在OC启动参数不包含 <code>keepsyms=1</code>时，让Lilu等Kexts性能更稳定</td></tr><tr><td>DisableRtcChecksum</td><td>NO</td><td></td><td>阻止AppleRTC写主校验和，对于一些重启后进入安全模式的用户有用</td></tr><tr><td>ExtendBTFeatureFlags</td><td>NO</td><td></td><td>对那些非apple或者fenvi网卡的人有用</td></tr><tr><td>LapicKernelPanic</td><td>NO</td><td>*</td><td>阻止内核崩溃，一般适用于惠普的系统</td></tr><tr><td>LegacyCommpage</td><td>NO</td><td></td><td>解决SSSE3依赖 🙈，一般跟奔腾64位cpu相关</td></tr><tr><td>PanicNoKextDump</td><td>YES</td><td>*</td><td>内核崩溃后保留日志</td></tr><tr><td>PowerTimeoutKernelPanic</td><td>YES</td><td>*</td><td>修复Catalina中电源状态变化时的系统崩溃</td></tr><tr><td>SetApfsTrimTimeout</td><td>-1</td><td></td><td>设置trim超时时间，单位微秒。碰到有问题的SSD时可能需要</td></tr><tr><td>XhciPortLimit</td><td>YES</td><td>*</td><td>开启后将usb端口限制在15个内，原因是UsbInjectAll重新实现了内置的macOS功能，而没有适当的当前调整。</td></tr></tbody></table><h4 id=misc>Misc</h4><h5 id=debug>Debug</h5><table><thead><tr><th>名称</th><th>值</th><th>修改？</th><th>说明</th></tr></thead><tbody><tr><td>AppleDebug</td><td>NO</td><td>*</td><td>开启boot.efi日志</td></tr><tr><td>ApplePanic</td><td>NO</td><td>*</td><td>将崩溃日志记录到硬盘</td></tr><tr><td>DisableWatchDog</td><td>YES</td><td>*</td><td>关闭UEFI watchdog</td></tr><tr><td>DisplayLevel</td><td>2147483650</td><td></td><td>展示更多的debug信息</td></tr><tr><td>SerialInit</td><td>NO</td><td></td><td>设置连续的输出</td></tr><tr><td>SysReport</td><td>NO</td><td></td><td>系统报告</td></tr><tr><td>Target</td><td>0</td><td>*</td><td>日志级别</td></tr></tbody></table><h5 id=security>Security</h5><table><thead><tr><th>名称</th><th>值</th><th>修改？</th><th>说明</th></tr></thead><tbody><tr><td>AllowNvramReset</td><td>YES</td><td>*</td><td>允许重置NVRAM</td></tr><tr><td>AllowSetDefault</td><td>YES</td><td>*</td><td>允许设置默认启动项</td></tr><tr><td>ApECID</td><td>0</td><td></td><td>用于对个性化的安全启动标识符进行网络划分。目前不可用，保持默认</td></tr><tr><td>AuthRestart</td><td>NO</td><td></td><td>为FileVault 2启用经过身份验证的重启，因此重启时不需要密码。</td></tr><tr><td>BlacklistAppleUpdate</td><td>YES</td><td>*</td><td>用于阻止固件更新，用作额外的保护级别，因为macOS Big Sur不再使用run-efi-updater变量</td></tr><tr><td>DmgLoading</td><td>Signed</td><td></td><td>确保仅加载签名DMG</td></tr><tr><td>ExposeSensitiveData</td><td>6</td><td></td><td>显示更多调试信息</td></tr><tr><td><strong>Vault</strong></td><td>Optional</td><td>*</td><td>很重要，填错启动不了。“Optional”是要填的值，大小写敏感。</td></tr><tr><td><strong>ScanPolicy</strong></td><td>0</td><td>*</td><td>很重要，填错启动不了。0允许我们查看所有可用的驱动器</td></tr><tr><td>SecureBootModel</td><td>Default</td><td>*</td><td>启用Apple的安全启动。不需要可以填Disabled</td></tr></tbody></table><h4 id=nvram>NVRAM</h4><h5 id=add-2>Add</h5><ol><li><p>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14</p><p>用于OC的UI缩放，默认即可。</p><ul><li>UIScale：ui缩放<ul><li>01：标准</li><li>02：HiDPI</li></ul></li><li>DefaultBackgroundColor<ul><li>00000000：黑</li><li>BFBFBF00：浅灰</li></ul></li></ul></li><li><p>4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102</p><p>OC的NVRAM GUID，主要与RTCMemoryFixup用户有关 。</p></li><li><p>7C436110-AB2A-4BBB-A880-FE41995C9F82</p><p>系统完整性保护位掩码</p><table><thead><tr><th>启动参数</th><th>说明</th></tr></thead><tbody><tr><td>-v</td><td>启动详细模式。能给你展现🍎logo下面的启动细节。个人感觉不需要，随意。</td></tr><tr><td>debug=0x100</td><td>禁用macOS的看门狗，防止内核崩溃时重新启动。</td></tr><tr><td>keepsyms=1</td><td>这是debug = 0x100的一项辅助设置，告诉操作系统留下内核崩溃日志。</td></tr><tr><td>alcid=1</td><td>用于设置AppleALC的layout-id，启动参数优先于前面在DeviceProperties中设置的layout-id。常用作调试。</td></tr><tr><td>agdpmod=pikera</td><td>A卡用户需要，我等核显用户不要</td></tr><tr><td>nvda_drv_vrl=1</td><td>在Sierra和HighSierra的Maxwell和Pascal卡上启用Nvidia的Web驱动程序。</td></tr><tr><td>-wegnoegpu</td><td>禁用除集成英特尔iGPU之外的所有其他GPU</td></tr></tbody></table><table><thead><tr><th>名称</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>csr-active-config</td><td>00000000</td><td>用于禁用SIP，目前不需要。保持默认。</td></tr><tr><td>run-efi-updater</td><td>No</td><td>防止macOS安装固件更新程序包、防止破坏启动顺序。</td></tr><tr><td>prev-lang:kbd</td><td>en-US:0</td><td>类型选String</td></tr></tbody></table></li></ol><h4 id=platforminfo>PlatformInfo</h4><p>生成三码，比较简单。注意好对应关系就成。</p><ul><li><p><code>Type</code> 对应 Generic -> SystemProductName.</p></li><li><p><code>Serial</code> 对应 Generic -> SystemSerialNumber.</p></li><li><p><code>Board Serial</code> 对应 Generic -> MLB.</p></li><li><p><code>SmUUID</code> 对应 Generic -> SystemUUID.</p></li></ul><h2 id=安装调试>安装调试</h2><h3 id=bios设置>BIOS设置</h3><p>需要禁用如下（其中vt-d和cfg lock找不着的话，可以在config.plist里面开启相应的参数）：</p><ul><li>Fast Boot</li><li>Secure Boot</li><li><strong>VT-d</strong></li><li>CSM</li><li>Intel SGX</li><li>Intel Platform Trust</li><li><strong>CFG Lock</strong> (MSR 0xE2 write protection)</li></ul><p>需要启用如下：</p><ul><li>VT-x</li><li>Above 4G decoding</li><li>Hyper-Threading</li><li>Execute Disable Bit</li><li>EHCI/XHCI Hand-off</li><li>DVMT Pre-Allocated(iGPU Memory): 64MB</li><li>SATA Mode: AHCI</li></ul><h3 id=安装系统>安装系统</h3><p>格式化安装mac的硬盘时，分区方式选择GUID partition，文件系统选APFS。接着就按照页面上的指引，对你的mac进行初始化吧。</p><hr><p>恭喜（👏🎉），到这儿，我们就完成了第一个目标：能用的黑果。后面就是一些调优的工作了，按照你的实际需求来。</p><h2 id=启动后调优>启动后调优</h2><ol><li><p>u盘启动到硬盘启动？</p><p>挂载u盘EFI分区</p><p>-> 将EFI分区中的EFI文件夹拷贝到黑果主机上</p><p>-> 卸载u盘EFI分区 -> 挂载安装黑果硬盘的EFI分区</p><p>-> 将EFI文件夹拷贝到主机的EFI分区中</p><p>-> 卸载主机EFI分区</p></li><li><p>显示器字体发虚？</p><ol><li>更换4k，效果最好</li><li>参考《<a href=https://github.com/xzhih/one-key-hidpi/blob/master/README-zh.md>一键开启 macOS HiDPI</a>》，开启HiDPI，个人试过，效果不是很好</li></ol></li><li><p>Usb3.0不识别，或者键盘鼠标需要重新插拔才能用</p><p>参考b站up主司波图的视频，定制USB端口映射</p></li><li><p>开机黑屏，必须重启显示器或者插拔连接线才能正常工作</p><p>TODO</p></li></ol><h2 id=mac-setup>Mac Setup</h2><p>mac Setup是指对一个刚安装好的 mac 系统进行系统配置和软件安装，适用于正规的 macOS 硬件和黑果。针对这部分内容，我会单独再写<a href=https://longfeis.me/2021/my-macos-setup/>一篇文章</a>。这里就不再赘述。</p><h2 id=成果展示环节>成果展示环节</h2><ul><li><p>系统信息<br><img src=https://cdn.jsdelivr.net/gh/longf2021/myImage/hackintosh/20210312083021.png alt=系统信息 loading=lazy></p></li><li><p>内存<br><img src=https://cdn.jsdelivr.net/gh/longf2021/myImage/hackintosh/20210312083113.png alt=内存 loading=lazy></p></li><li><p>核显<br><img src=https://cdn.jsdelivr.net/gh/longf2021/myImage/hackintosh/20210312084248.png alt=显卡 loading=lazy></p></li><li><p>蓝牙和无线<br><img src=https://cdn.jsdelivr.net/gh/longf2021/myImage/hackintosh/20210312083451.png alt=蓝牙 loading=lazy></p></li><li><p>测试隔空投送功能<br><img src=https://cdn.jsdelivr.net/gh/longf2021/myImage/hackintosh/20210312084101.png alt=隔空投送 loading=lazy></p></li></ul><h2 id=附录一英特尔cpu>附录一：英特尔CPU</h2><h3 id=发展历史>发展历史</h3><table><thead><tr><th>芯片架构</th><th>备注</th></tr></thead><tbody><tr><td>4004</td><td>1971年11月15日世界上第一块个人微型处理器4004诞生</td></tr><tr><td>8086</td><td>1978年6月8日</td></tr><tr><td>80286</td><td>1982年2月2日，英特尔的最后一块16位处理器</td></tr><tr><td>80386</td><td>1985年，开始进入到了32位时代</td></tr><tr><td>Pentium</td><td>奔腾时代</td></tr><tr><td>Core</td><td>酷睿时代</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id=-台式机微架构名称>🖥️ 台式机微架构名称</h3><table><thead><tr><th style=text-align:left>Code Name</th><th style=text-align:left>Series</th><th style=text-align:left>Release</th></tr></thead><tbody><tr><td style=text-align:left>Yonah, Conroe and Penryn</td><td style=text-align:left>E8XXX, Q9XXX</td><td style=text-align:left>2006-2009 era</td></tr><tr><td style=text-align:left>Lynnfield and Clarkdale</td><td style=text-align:left>5XX-8XX</td><td style=text-align:left>2010 era</td></tr><tr><td style=text-align:left>Sandy Bridge</td><td style=text-align:left>2XXX</td><td style=text-align:left>2011 era</td></tr><tr><td style=text-align:left>Ivy Bridge</td><td style=text-align:left>3XXX</td><td style=text-align:left>2012 era</td></tr><tr><td style=text-align:left>Haswell</td><td style=text-align:left>4XXX</td><td style=text-align:left>2013-2014 era</td></tr><tr><td style=text-align:left>Skylakex</td><td style=text-align:left>6XXX</td><td style=text-align:left>2015-2016 era</td></tr><tr><td style=text-align:left>Kaby Lakex</td><td style=text-align:left>7XXX</td><td style=text-align:left>2017 era</td></tr><tr><td style=text-align:left>Coffee Lake</td><td style=text-align:left>8XXX-9XXX</td><td style=text-align:left>2017-2019 era</td></tr><tr><td style=text-align:left>Comet Lake</td><td style=text-align:left>10XXX</td><td style=text-align:left>2020 era</td></tr><tr><td style=text-align:left></td><td style=text-align:left></td><td></td></tr></tbody></table><h3 id=-笔记本微架构名称>💻 笔记本微架构名称</h3><table><thead><tr><th style=text-align:left>Code Name</th><th style=text-align:left>Series</th><th style=text-align:left>Release</th></tr></thead><tbody><tr><td style=text-align:left>Clarksfield and Arrandale</td><td style=text-align:left>3XX-9XX</td><td style=text-align:left>2010 era</td></tr><tr><td style=text-align:left>Sandy Bridge</td><td style=text-align:left>2XXX</td><td style=text-align:left>2011 era</td></tr><tr><td style=text-align:left>Ivy Bridge</td><td style=text-align:left>3XXX</td><td style=text-align:left>2012 era</td></tr><tr><td style=text-align:left>Haswell</td><td style=text-align:left>4XXX</td><td style=text-align:left>2013-2014 era</td></tr><tr><td style=text-align:left>Broadwell]</td><td style=text-align:left>5XXX</td><td style=text-align:left>2014-2015 era</td></tr><tr><td style=text-align:left>Skylake</td><td style=text-align:left>6XXX</td><td style=text-align:left>2015-2016 era</td></tr><tr><td style=text-align:left>Kaby Lake and Amber Lake</td><td style=text-align:left>7XXX</td><td style=text-align:left>2017 era</td></tr><tr><td style=text-align:left>Coffee Lake and Whiskey Lake</td><td style=text-align:left>8XXX</td><td style=text-align:left>2017-2018 era</td></tr><tr><td style=text-align:left>Coffee Lake Plus and Comet Lake</td><td style=text-align:left>9XXX-10XXX</td><td style=text-align:left>2019-2020 era</td></tr><tr><td style=text-align:left>Ice Lake</td><td style=text-align:left>10XXX</td><td style=text-align:left>2019-2020 era</td></tr><tr><td style=text-align:left></td><td style=text-align:left></td><td></td></tr></tbody></table><h2 id=参考资料>参考资料</h2><ol><li><a href=https://dortania.github.io/OpenCore-Install-Guide/>OpenCore-Install-Guide</a>黑果入门级教程，写得非常详细</li><li><a href=https://dortania.github.io/OpenCore-Post-Install/>OpenCore-Post-Install</a> 黑果安装后调优</li><li><a href=https://www.bilibili.com/video/BV18V41187JZ>新手挑战黑苹果-超详细的OpenCore黑苹果安装教程</a> B站上的视频教程</li><li><a href=https://www.bilibili.com/video/BV1Aa4y1j7CL>10代平台黑苹果Opencore6.0下的声卡驱动&USB定制</a></li><li><a href=https://zh.wikipedia.org/wiki/%E8%8B%B1%E7%89%B9%E5%B0%94%E5%BE%AE%E5%A4%84%E7%90%86%E5%99%A8%E5%88%97%E8%A1%A8>英特尔微处理器列表</a></li></ol><center>·End·</center></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>longfei</span></p><p class=copyright-item><span>Link:</span>
<a href=https://longfeis.me/2020/hackintosh/>https://longfeis.me/2020/hackintosh/</span></p><p class="copyright-item lincese">本文采用<a rel=license href=https://creativecommons.org/licenses/by-nc-nd/3.0/cn/deed.zh style=color:#add8e6 target=_blank>《署名-非商业性使用-禁止演绎 3.0 中国大陆》</a> 协议进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://longfeis.me/tags/macos/>#macOS</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://longfeis.me/>home</a></span></section></div><div class=post-nav><a href=https://longfeis.me/2020/hello-hugo-blog/ class=prev rel=prev title="Hello Hugo Blog"><i class="iconfont icon-left"></i>&nbsp;Hello Hugo Blog</a>
<a href=https://longfeis.me/2021/my-macos-setup/ class=next rel=next title="My macOS Setup">My macOS Setup&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2021</span>
<span class=with-love><i class="iconfont icon-love"></i></span>
<span class=author itemprop=copyrightHolder><a href=https://longfeis.me/>longfei</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span></div></footer><script defer src=/js/vendor_main.min.js></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script></div></body></html>